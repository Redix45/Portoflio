---
const { srcBase, alt = '', sizes = '(max-width: 800px) 100vw, 800px' } = Astro.props;
// srcBase e.g. '/photos_optimized/operetka/foto (2)'
function encodePath(p) {
  return p.split('/').map(encodeURIComponent).join('/');
}
const safeBase = encodePath(srcBase.replace(/^\/+/, ''));
const baseUrl = `/${safeBase}`;
const sources = [400, 800, 1200, 1600];
const srcset = sources.map(s => `${baseUrl}-${s}.webp ${s}w`).join(', ');
const srcDefault = `${baseUrl}-400.webp`;
---
<picture>
  <source type="image/webp" srcset={srcset} sizes={sizes} />
  <img src={srcDefault} srcset={srcset} alt={alt} loading="lazy" sizes={sizes} decoding="async" style="width:100%;height:100%;object-fit:cover;" />
</picture>
